# ğŸ³ Docker Compose íŒŒì¼ ë¶„ë¦¬ ê°€ì´ë“œ

## 1. Compose íŒŒì¼ ë¶„ë¦¬í•˜ê¸°

ì¼ë°˜ì ìœ¼ë¡œ **ì‹¤ë¬´ì—ì„œëŠ” ê°œë°œìš©ê³¼ ìš´ì˜ìš© Compose íŒŒì¼ì„ ë¶„ë¦¬**í•©ë‹ˆë‹¤.
ë³¸í†µ ë‹¤ìŒ ë‘ íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

* `docker-compose.dev.yml`
* `docker-compose.prod.yml`

### ğŸ§¬ ê°œë°œìš© (`docker-compose.dev.yml`)

* `target`: `development`
* `command`: `pnpm run start:dev <ì„œë¹„ìŠ¤ëª…>`
* `volumes`: **í¬í•¨** (ì†ŒìŠ¤ì½”ë“œ ë³€ê²½ ì‹œ ìë™ ë°˜ì˜)

```yaml
services:
  gateway:
    build:
      context: .
      dockerfile: ./apps/gateway/Dockerfile
      target: development
    command: pnpm run start:dev gateway
    env_file:
      - ./apps/gateway/.env
    volumes:
      - .:/app
    ports:
      - '3000:3000'
```

---

### ğŸš€ ìš´ì˜ìš© (`docker-compose.prod.yml`)

* `target`: `production`
* `command`: ì œê±° (â†’ Dockerfileì˜ `CMD` ì‚¬ìš©)
* `volumes`: ì œê±° (ìš´ì˜ ì‹œ ì†ŒìŠ¤ì½”ë“œ ë¶ˆí•„ìš”)
* `ports`, `env_file`: ìœ ì§€

```yaml
services:
  gateway:
    build:
      context: .
      dockerfile: ./apps/gateway/Dockerfile
      target: production
    env_file:
      - ./apps/gateway/.env
    ports:
      - '3000:3000'
```

> âœ… ì—¬ê¸°ì„œëŠ” `command`ì™€ `volumes`ë¥¼ **ì•„ì˜ˆ ì œê±°**í–ˆìŠµë‹ˆë‹¤.
> ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì´ë¯¸ `dist`ë¡œ ë¹Œë“œëœ ê²°ê³¼ë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, Dockerfileì˜ `CMD (node dist/apps/gateway/main)`ì´ ê·¸ëŒ€ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

---

## 2. ì‹¤í–‰ ë°©ë²•

### ğŸ”§ ê°œë°œ í™˜ê²½

```bash
docker compose -f docker-compose.dev.yml up --build -d
```

### ğŸŒ ìš´ì˜ í™˜ê²½

```bash
docker compose -f docker-compose.prod.yml up --build -d
```

---

## âš¡ ì •ë¦¬

* í˜„ì¬ `docker-compose.yml`ì€ **ê°œë°œ ëª¨ë“œ ì „ìš©**ì´ë¼ ìš´ì˜ì— ì“°ë©´ ì•ˆ ë©ë‹ˆë‹¤.
* ìš´ì˜ì—ì„œëŠ” `target: production`ìœ¼ë¡œ ë§¤ë²ˆ ë°”ê¾¸ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **compose íŒŒì¼ ë¶„ë¦¬**ê°€ ê°€ì¥ íš¨ìœ¨ì ì…ë‹ˆë‹¤.
* ë³¸ë³´ì ìœ¼ë¡œ `docker-compose.override.yml`ê³¼ `docker-compose.prod.yml`ì„ **ë”°ë¡œ êµ¬ì„±**í•˜ëŠ” íŒ¨í„´ì„ ë§ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.
